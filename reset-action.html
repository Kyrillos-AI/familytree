<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="landing.css" />
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: #0f172a;
        overflow: hidden;
      }
      .reset-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 2rem;
        border-radius: 20px;
        width: 100%;
        max-width: 400px;
        text-align: center;
        color: white;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      .status-msg {
        margin-top: 10px;
        font-size: 0.9rem;
        min-height: 20px;
      }
    </style>
  </head>
  <body>
    <div class="aurora-bg">
      <div class="aurora-blob b1"></div>
      <div class="aurora-blob b2"></div>
    </div>

    <div class="reset-card" id="reset-content">
      <h3>ğŸ” ÙƒÙ„Ù…Ø© Ø³Ø± Ø¬Ø¯ÙŠØ¯Ø©</h3>
      <p style="color: #ccc; margin-bottom: 20px">
        Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­Ø³Ø§Ø¨Ùƒ
      </p>

      <div class="custom-input-group">
        <span class="input-icon">ğŸ”‘</span>
        <input
          type="password"
          id="new-password"
          placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©"
        />
      </div>

      <button class="action-btn" onclick="confirmNewPassword()">
        Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
      </button>
      <div id="msg-box" class="status-msg"></div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        confirmPasswordReset,
        verifyPasswordResetCode,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDDuWxwcYI3l6UAj2UsMzSBVFYFACjck94",
        authDomain: "familytree-7c8be.firebaseapp.com",
        projectId: "familytree-7c8be",
        storageBucket: "familytree-7c8be.firebasestorage.app",
        messagingSenderId: "140789780230",
        appId: "1:140789780230:web:b815fccf7d4e5fc02a5887",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // 1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
      const urlParams = new URLSearchParams(window.location.search);
      const oobCode = urlParams.get("oobCode");
      const msgBox = document.getElementById("msg-box");
      const btn = document.querySelector("button");

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙˆØ± ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
      if (!oobCode) {
        document.body.innerHTML =
          "<h2 style='color:white; text-align:center'>Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© âŒ</h2>";
      } else {
        // ÙØ­Øµ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¬Ø±Ø¨Ø©)
        verifyPasswordResetCode(auth, oobCode)
          .then((email) => {
            msgBox.innerText = `Ø¬Ø§Ø±ÙŠ ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù„Ø­Ø³Ø§Ø¨: ${email}`;
            msgBox.style.color = "#4ade80";
          })
          .catch((error) => {
            msgBox.innerText = "Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© âŒ";
            msgBox.style.color = "#ff4757";
            btn.disabled = true;
            btn.style.opacity = "0.5";
          });
      }

      // 2. Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸
      window.confirmNewPassword = async () => {
        const newPass = document.getElementById("new-password").value;
        if (newPass.length < 6) {
          msgBox.innerText = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ âš ï¸";
          msgBox.style.color = "#fbbf24";
          return;
        }

        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
        btn.disabled = true;

        try {
          await confirmPasswordReset(auth, oobCode, newPass);

          document.getElementById("reset-content").innerHTML = `
                    <div style="font-size:3rem">âœ…</div>
                    <h3>ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!</h3>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
                    <button class="action-btn" onclick="window.location.href='index.html'">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                `;
        } catch (error) {
          console.error(error);
          msgBox.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message;
          msgBox.style.color = "#ff4757";
          btn.innerText = "Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹";
          btn.disabled = false;
        }
      };
    </script>
  </body>
</html>
